<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="page-title">WIZs | Anonymous Chat</title>
    <link id="favicon" rel="icon" href="https://cdn-icons-png.flaticon.com/512/3659/3659744.png">
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0a0a0a; --card: #161616; --blue: #00f2fe; --mint: #7bed9f; --red: #ff4d4d; --yellow: #f1c40f; --gray: #333; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 180px; overflow-x: hidden; }

        /* --- STATUS BAR --- */
        #status-bar { position: fixed; top: 0; left: 0; width: 100%; background: #111; padding: 10px 20px; z-index: 2000; border-bottom: 1px solid #222; display: grid; grid-template-columns: auto 1fr auto; align-items: center; box-sizing: border-box; gap: 15px; }
        .bar-left { display: flex; align-items: center; gap: 15px; }
        .bar-center { font-weight: 900; font-size: 1.2rem; letter-spacing: 2px; color: var(--blue); text-shadow: 0 0 10px rgba(0,242,254,0.3); text-align: center; }
        .bar-right { display: flex; align-items: center; gap: 12px; justify-content: flex-end; }
        
        .icon-btn { cursor: pointer; color: #888; transition: 0.2s; font-size: 16px; }
        .icon-btn:hover { color: white; transform: scale(1.1); }
        .report-link { color: #555; text-decoration: none; font-size: 10px; border: 1px solid #222; padding: 2px 6px; border-radius: 4px; white-space: nowrap; }

        /* --- STATUS DOTS --- */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; transition: all 0.3s ease; }
        .status-green { background: #2ecc71; box-shadow: 0 0 8px #2ecc71; }
        .status-orange { background: var(--yellow); box-shadow: 0 0 8px var(--yellow); }
        .status-red { background: var(--red); box-shadow: 0 0 8px var(--red); }

        /* --- MEDIA SIDEBAR --- */
        #media-sidebar { position: fixed; top: 50px; left: 0; width: 320px; height: calc(100% - 50px); background: #0f0f0f; border-right: 1px solid #333; z-index: 1999; transform: translateX(-100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); padding: 15px; overflow-y: auto; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
        #media-sidebar.active { transform: translateX(0); }
        .media-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .sidebar-item { width: 100%; border-radius: 6px; border: 1px solid #333; background: #000; aspect-ratio: 1/1; object-fit: cover; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        /* --- ADMIN EFFECTS --- */
        @keyframes rainbowGlow { 0% { border-color: red; box-shadow: 0 0 10px red; } 16% { border-color: orange; } 32% { border-color: yellow; } 48% { border-color: green; } 64% { border-color: blue; } 80% { border-color: violet; } 100% { border-color: red; box-shadow: 0 0 10px red; } }
        
        /* The effect on the MESSAGE BUBBLE (Public) */
        .rainbow-msg-box { animation: rainbowGlow 4s linear infinite; border: 2px solid transparent !important; }

        /* The effect on the INPUT FIELD (Private) */
        .rainbow-input-local { animation: rainbowGlow 6s linear infinite !important; border-width: 2px !important; }
        
        @keyframes textShine { to { background-position: 200% center; } }
        .rainbow-name { background: linear-gradient(to right, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff, #ff0000); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: textShine 3s linear infinite; font-weight: 900; }

        /* --- MODALS --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { background: #111; padding: 25px; border-radius: 20px; max-width: 450px; width: 90%; text-align: center; border: 1px solid var(--gray); position: relative; }
        .modal-btn { background: var(--blue); color: black; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; margin-top: 15px; }

        /* Change Log */
        .changelog-text { text-align: left; font-family: 'Consolas', monospace; font-size: 13px; color: #ccc; line-height: 1.5; margin: 15px 0; background: #000; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .version-tag { color: var(--mint); font-weight: bold; }

        /* --- GIF PICKER --- */
        #gif-results { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 300px; overflow-y: auto; margin-top: 15px; padding: 5px; }
        .tenor-gif { width: 100%; border-radius: 8px; cursor: pointer; background: #222; transition: 0.2s; }

        /* --- FEED & MESSAGES --- */
        #feed { max-width: 600px; margin: 80px auto 0; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { background: var(--card); padding: 15px; border-radius: 12px; border-left: 4px solid var(--u-color); position: relative; animation: slideIn 0.2s ease-out; cursor: pointer; border: 1px solid transparent; }
        
        .vid-container { position: relative; width: 100%; margin-top: 10px; border-radius: 8px; overflow: hidden; background: #000; }
        .mute-btn { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.6); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; z-index: 10; font-size: 12px; visibility: hidden; }
        .unblurred + .mute-btn { visibility: visible; }
        .media-msg { width: 100%; border-radius: 8px; filter: blur(45px); transition: filter 0.4s ease; display: block; background: #000; }
        .unblurred { filter: blur(0) !important; }

        /* Notifications & Replies */
        .was-replied-to { border: 1px solid var(--mint) !important; box-shadow: 0 0 10px rgba(123, 237, 159, 0.1); }
        .reply-notif-tag { color: var(--mint); font-size: 10px; font-weight: bold; margin-top: 8px; display: block; border-top: 1px solid #222; padding-top: 5px; }
        .is-reply-to-me { background: #1a1f24; border-right: 3px solid var(--blue); }

        /* --- INPUT --- */
        .input-wrap { position: fixed; bottom: 0; width: 100%; background: rgba(10,10,10,0.98); padding: 15px 20px; border-top: 1px solid #222; backdrop-filter: blur(15px); z-index: 2000; }
        #reply-preview { display: none; background: #222; padding: 8px 15px; border-radius: 8px 8px 0 0; font-size: 12px; border-left: 3px solid var(--blue); justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .input-controls { display: flex; gap: 12px; align-items: center; }
        input[type="text"] { flex-grow: 1; background: #1a1a1a; border: 1px solid #333; padding: 12px; color: white; border-radius: 8px; outline: none; transition: 0.3s; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .user-item { padding: 8px; border-bottom: 1px solid #222; cursor: pointer; display: flex; justify-content: space-between; font-size: 12px; }
        #userListContainer { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; max-height: 100px; overflow-y: auto; margin: 10px 0; padding: 5px; text-align: left; }
        
        .admin-toggle { display: none; margin-top: 10px; border-top: 1px solid #333; padding-top: 10px; }
        .admin-toggle label { display: block; font-size: 12px; margin-bottom: 5px; cursor: pointer; color: var(--yellow); }
    </style>
</head>
<body>

<div id="media-sidebar">
    <div class="sidebar-header">
        <span style="font-weight:bold; color:var(--blue)">Media Gallery</span>
        <span onclick="toggleSidebar()" style="cursor:pointer; color:#666">âœ•</span>
    </div>
    <div class="media-grid" id="sidebar-content"></div>
</div>

<div id="changelogModal" class="modal">
    <div class="modal-content">
        <h3><i class="fa-solid fa-terminal" style="color:var(--mint)"></i> System Log</h3>
        <p style="color:var(--blue); font-weight:bold; font-size:14px;">You are LIVE on the current version. (V.3.3) on WIZs servers.</p>
        <div class="changelog-text">
            <span class="version-tag">V.3.3 (1/29/2026)</span><br>
            adds user customizations - blocking users - media upload (video files, youtube video links, Gifs) - refined reply system - new View all media button and changelogs!<br>
            <span style="color:var(--yellow)">* Owner Tools: Rainbow Message Box (Public) & Rainbow Name added.</span><br><br>
            <span style="color:#666">V.3.3 adds quality of life and much much more! last public version (V.1.2) was bare and simple.</span>
        </div>
        <button class="modal-btn" onclick="closeModal('changelogModal')">close</button>
    </div>
</div>

<div id="welcomeModal" class="modal" style="display: flex;">
    <div class="modal-content">
        <h2 style="color:var(--blue)">Welcome to WIZs</h2>
        <p>Anonymous chatting. No logs. No trace.<br>Automatic wipe every 15 minutes.</p>
        <button class="modal-btn" onclick="initAudio(); closeModal('welcomeModal')">Begin Chatting</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h3>User Settings</h3>
        <input type="text" id="newNick" placeholder="Change nickname..." maxlength="15" style="width:90%; padding:10px; background:#222; border:1px solid #444; color:white; border-radius:8px;">
        <p style="font-size:12px; margin-top:10px;">Name Color:</p>
        <div id="colorPicker" style="display:grid; grid-template-columns: repeat(5, 1fr); gap: 5px;"></div>
        <p style="font-size:12px; margin-top:15px;">Block Users:</p>
        <div id="userListContainer"></div>
        
        <div id="adminControls" class="admin-toggle">
            <p style="color:var(--yellow); font-weight:bold;">Owner Controls</p>
            <p style="font-size:10px; color:#666; margin-bottom:5px;">Visible to Everyone:</p>
            <label><input type="checkbox" id="toggleRainbowName" checked onchange="toggleAdminFx()"> Rainbow Name Text</label>
            <label><input type="checkbox" id="toggleRainbowBox" checked onchange="toggleAdminFx()"> Rainbow Message Box</label>
            <p style="font-size:10px; color:#666; margin-bottom:5px; margin-top:10px;">Visible to You:</p>
            <label><input type="checkbox" id="toggleRainbowInput" checked onchange="toggleAdminFx()"> Rainbow Input Field</label>
        </div>

        <button class="modal-btn" style="background:var(--red); color:white;" onclick="unblockAll()">Unblock All</button>
        <button class="modal-btn" onclick="saveSettings()">Save & Close</button>
    </div>
</div>

<div id="gifModal" class="modal">
    <div class="modal-content">
        <h3>Tenor GIF Search</h3>
        <input type="text" id="gifSearchInput" placeholder="Search for GIFs..." style="width:90%; padding:10px; background:#222; border:1px solid #444; color:white; border-radius:8px;">
        <div id="gif-results"></div>
        <button class="modal-btn" style="background:#333; color:white;" onclick="closeModal('gifModal')">Close</button>
    </div>
</div>

<div id="status-bar">
    <div class="bar-left">
        <i class="fa-solid fa-gear icon-btn" onclick="openSettings()" title="Settings"></i>
        <i class="fa-solid fa-photo-film icon-btn" onclick="toggleSidebar()" title="Media Gallery"></i>
        <i class="fa-solid fa-terminal icon-btn" onclick="document.getElementById('changelogModal').style.display='flex'" title="Changelogs"></i>
        <span id="reset-timer" style="font-size: 11px; margin-left: 5px; color:#555;">15:00</span>
    </div>
    <div class="bar-center">WIZs</div>
    <div class="bar-right">
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSeChvOFtxPM9caxUlsDXyzw903xFSm0WmvQ9yeNEswdFuoBpw/viewform?usp=header" target="_blank" class="report-link">Report issues</a>
        <div style="display:flex; align-items:center; gap:5px;">
            <span id="connection-dot" class="status-dot status-orange" title="Connecting..."></span>
            <span id="count-display" style="font-size:10px; color:var(--blue);">0 Online</span>
        </div>
    </div>
</div>

<div id="feed"></div>

<div class="input-wrap">
    <div id="reply-preview"><span id="reply-text" style="color:var(--blue); font-size:11px;">Replying...</span><span id="cancel-reply" style="cursor:pointer; color:var(--red); margin-left:10px;">Ã—</span></div>
    <div class="input-controls">
        <label style="cursor:pointer; color:var(--blue); font-size:20px;"><i class="fa-solid fa-paperclip"></i><input type="file" id="mediaInput" hidden accept="image/*,video/*"></label>
        <span onclick="openGIFs()" style="cursor:pointer; color:var(--mint); font-weight:bold; font-size:14px;">GIF</span>
        <input type="text" id="wizsInput" placeholder="Message, Tenor, or YouTube link..." autocomplete="off">
    </div>
</div>

<script>
    const socket = io();
    let myName = "Wiz-" + Math.floor(Math.random()*999);
    let myColor = "#00f2fe";
    let myId = "";
    let selectedReply = null; 
    let blockedIds = new Set();
    let discoveredUsers = {}; 
    let audioCtx = null;
    
    // --- ADMIN STATE ---
    let isAdmin = false;
    let adminRainbowInput = false; // Local only
    let adminRainbowName = false;  // Public
    let adminRainbowBox = false;   // Public (The message bubble)

    // --- CONNECTION STATUS ---
    const dot = document.getElementById('connection-dot');
    socket.on('connect', () => { dot.className = 'status-dot status-green'; dot.title = "Connected"; });
    socket.on('disconnect', () => { dot.className = 'status-dot status-red'; dot.title = "Disconnected"; });
    socket.on('connect_error', () => { dot.className = 'status-dot status-orange'; dot.title = "Connection Issues"; });
    socket.on('reconnect_attempt', () => { dot.className = 'status-dot status-orange'; dot.title = "Reconnecting..."; });

    // --- AUDIO & NOTIFICATIONS ---
    function initAudio() { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function playBeep() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
        osc.type = "sine"; osc.frequency.setValueAtTime(550, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }
    function drawNotificationBadge() {
        const favicon = document.getElementById('favicon'); const canvas = document.createElement('canvas');
        canvas.width = 32; canvas.height = 32; const ctx = canvas.getContext('2d');
        const img = new Image(); img.crossOrigin = "anonymous"; img.src = "https://cdn-icons-png.flaticon.com/512/3659/3659744.png";
        img.onload = () => {
            ctx.drawImage(img, 0, 0, 32, 32); ctx.beginPath(); ctx.arc(24, 8, 8, 0, 2 * Math.PI); ctx.fillStyle = "#ff4d4d"; ctx.fill();
            favicon.href = canvas.toDataURL('image/png'); document.title = "( ! ) WIZs | New Reply";
        };
    }
    window.onfocus = () => { document.getElementById('favicon').href = "https://cdn-icons-png.flaticon.com/512/3659/3659744.png"; document.title = "WIZs | Anonymous Chat"; };

    // --- SIDEBAR TOGGLE ---
    function toggleSidebar() { document.getElementById('media-sidebar').classList.toggle('active'); }

    // --- TENOR GIF SYSTEM ---
    async function fetchGIFs(q) {
        const url = `https://tenor.googleapis.com/v2/search?q=${q}&key=LIVNE7WABNEL&limit=12&client_key=wizs_v3`;
        try {
            const res = await fetch(url); const data = await res.json();
            const container = document.getElementById('gif-results'); container.innerHTML = '';
            data.results.forEach(gif => {
                const img = document.createElement('img'); img.src = gif.media_formats.tinygif.url; img.className = 'tenor-gif';
                img.onclick = () => {
                    sendMsg("[GIF]", gif.media_formats.gif.url, "image");
                    closeModal('gifModal');
                };
                container.appendChild(img);
            });
        } catch (e) { console.error(e); }
    }
    function openGIFs() { document.getElementById('gifModal').style.display = 'flex'; fetchGIFs("trending"); }
    document.getElementById('gifSearchInput').oninput = (e) => fetchGIFs(e.target.value || "trending");

    // --- BLUR & MUTE LOGIC ---
    window.toggleMedia = (el) => {
        const isBlurred = !el.classList.contains('unblurred');
        if (isBlurred) { el.classList.add('unblurred'); if (el.tagName === 'VIDEO') el.play(); } 
        else { el.classList.remove('unblurred'); if (el.tagName === 'VIDEO') { el.pause(); el.muted = true; } }
    };
    window.toggleMute = (btn, vidId) => {
        const v = document.getElementById(vidId); v.muted = !v.muted;
        btn.innerHTML = v.muted ? '<i class="fa-solid fa-volume-xmark"></i>' : '<i class="fa-solid fa-volume-high"></i>';
    };

    // --- SOCKET LOGIC ---
    socket.on('assign-id', id => myId = id);
    socket.on('user-count', c => document.getElementById('count-display').innerText = `${c} Online`);
    socket.on('timer-update', s => { const m = Math.floor(s/60); const sec = s%60; document.getElementById('reset-timer').innerText = `${m}:${sec<10?'0':''}${sec}`; });
    socket.on('room-reset', () => location.reload());

    socket.on('receive-msg', data => {
        if (data.userId !== myId && !discoveredUsers[data.userId]) discoveredUsers[data.userId] = data.name;
        if (blockedIds.has(data.userId)) return;

        const div = document.createElement('div'); div.className = 'msg'; div.id = data.msgId; div.style.setProperty('--u-color', data.color);
        if (data.replyTo && data.replyTo.name === myName) {
            div.classList.add('is-reply-to-me');
            if (document.hidden || !document.hasFocus()) { playBeep(); drawNotificationBadge(); }
        }

        let mediaHtml = ''; let sidebarHtml = '';
        if (data.image) {
            mediaHtml = `<img src="${data.image}" class="media-msg" onclick="event.stopPropagation(); toggleMedia(this)">`;
            sidebarHtml = `<img src="${data.image}" class="sidebar-item" title="By ${data.name}">`;
        }
        if (data.video) {
            const vidId = "v-" + data.msgId;
            mediaHtml = `<div class="vid-container"><video id="${vidId}" src="${data.video}" class="media-msg" onclick="event.stopPropagation(); toggleMedia(this)" loop muted></video><button class="mute-btn" onclick="event.stopPropagation(); toggleMute(this, '${vidId}')"><i class="fa-solid fa-volume-xmark"></i></button></div>`;
            sidebarHtml = `<video src="${data.video}" class="sidebar-item" controls muted title="By ${data.name}"></video>`;
        }
        if (data.text.includes('youtube.com') || data.text.includes('youtu.be')) {
            const vid = data.text.split('v=')[1]?.split('&')[0] || data.text.split('.be/')[1];
            if (vid) {
                mediaHtml += `<iframe width="100%" height="250" src="https://www.youtube.com/embed/${vid}" frameborder="0" style="margin-top:10px; border-radius:8px;" allowfullscreen></iframe>`;
                sidebarHtml = `<iframe class="sidebar-item" src="https://www.youtube.com/embed/${vid}" frameborder="0"></iframe>`;
            }
        }
        if (data.text.includes('tenor.com')) {
            const tenorMatch = data.text.match(/tenor\.com\/(?:view\/.*-)?(?:.*-)?(\d+)/) || data.text.match(/tenor\.com\/([\w\d]+)\.gif/);
            if (tenorMatch) {
                const url = `https://media.tenor.com/${tenorMatch[1]}/tenor.gif`;
                mediaHtml += `<img src="${url}" class="media-msg" onclick="event.stopPropagation(); toggleMedia(this)">`;
                sidebarHtml = `<img src="${url}" class="sidebar-item" title="By ${data.name}">`;
            }
        }

        if (sidebarHtml) { const i = document.createElement('div'); i.innerHTML = sidebarHtml; document.getElementById('sidebar-content').prepend(i); }

        let replyHeader = data.replyTo ? `<div style="font-size:11px; color:#666; font-style:italic;">Replying to @${data.replyTo.name}</div>` : '';
        if (data.replyTo) {
            const orig = document.getElementById(data.replyTo.msgId);
            if (orig && !orig.querySelector('.reply-notif-tag')) { const t = document.createElement('span'); t.className = 'reply-notif-tag'; t.innerText = `ðŸ’¬ ${data.name} replied.`; orig.appendChild(t); }
        }

        // --- OWNER/ADMIN RENDER LOGIC ---
        // 1. Rainbow Name (Text)
        let nameClass = "";
        if (data.name === "WIZs Owner" || data.isRainbowName) { nameClass = "rainbow-name"; }
        
        // 2. Rainbow Message Box (Border/Glow)
        if (data.isRainbowBox) { div.classList.add('rainbow-msg-box'); }

        div.innerHTML = `${replyHeader}<div class="${nameClass}" style="font-weight:bold; color:${data.color}">${data.name}</div><div>${data.text}</div>${mediaHtml}`;
        div.onclick = () => { selectedReply = { name: data.name, msgId: data.msgId }; document.getElementById('reply-preview').style.display = 'flex'; document.getElementById('reply-text').innerText = `Replying to @${data.name}`; document.getElementById('wizsInput').focus(); };
        document.getElementById('feed').appendChild(div); window.scrollTo(0, document.body.scrollHeight);
    });

    // --- SEND MESSAGE WRAPPER ---
    function sendMsg(text, mediaData = null, mediaType = null) {
        const payload = { 
            name: myName, 
            color: myColor, 
            text: text, 
            replyTo: selectedReply, 
            msgId: (mediaType ? "u-" : "m-") + Date.now(),
            // Pass admin toggles to server so everyone sees them
            isRainbowName: (isAdmin && adminRainbowName),
            isRainbowBox: (isAdmin && adminRainbowBox) 
        };
        if (mediaType && mediaData) payload[mediaType] = mediaData;
        socket.emit('send-msg', payload);
        
        // Clear inputs
        document.getElementById('wizsInput').value = ''; 
        selectedReply = null; 
        document.getElementById('reply-preview').style.display = 'none';
    }

    document.getElementById('wizsInput').onkeydown = e => { if (e.key === 'Enter' && e.target.value.trim()) sendMsg(e.target.value); };
    document.getElementById('mediaInput').onchange = e => { const f = e.target.files[0]; const r = new FileReader(); r.onload = () => { const t = f.type.startsWith('video') ? 'video' : 'image'; sendMsg(`[Shared ${t}]`, r.result, t); }; r.readAsDataURL(f); };

    const colors = ['#00f2fe', '#4facfe', '#2ecc71', '#e74c3c', '#f1c40f', '#9b59b6', '#ff9f43', '#1abc9c', '#3498db', '#ffffff'];
    colors.forEach(c => { const d = document.createElement('div'); d.style.background = c; d.style.height = '20px'; d.style.borderRadius = '4px'; d.style.cursor = 'pointer'; d.onclick = () => myColor = c; document.getElementById('colorPicker').appendChild(d); });
    
    // --- SETTINGS & ADMIN LOGIC ---
    function openSettings() {
        const c = document.getElementById('userListContainer'); c.innerHTML = '';
        Object.keys(discoveredUsers).forEach(id => { const i = document.createElement('div'); i.className = 'user-item'; i.innerHTML = `<span>${discoveredUsers[id]}</span> <span style="color:var(--red)">${blockedIds.has(id)?'Blocked':'Block'}</span>`; i.onclick = () => { blockedIds.has(id)?blockedIds.delete(id):blockedIds.add(id); openSettings(); }; c.appendChild(i); });
        
        // Toggle Visibility of Admin Controls
        document.getElementById('adminControls').style.display = isAdmin ? 'block' : 'none';
        document.getElementById('settingsModal').style.display = 'flex';
    }

    function saveSettings() { 
        const n = document.getElementById('newNick').value; 
        
        // ADMIN ACTIVATION
        if (n === 'Admin1') {
            isAdmin = true;
            myName = "WIZs Owner";
            adminRainbowInput = true;
            adminRainbowName = true;
            adminRainbowBox = true;
            document.getElementById('newNick').value = ""; // Clear security
            toggleAdminFx();
            alert("Owner Identity Verified.");
        } 
        // LOSS OF ADMIN STATUS
        else if(n && n !== "") {
            isAdmin = false; // Remove powers
            myName = n; 
        }
        
        closeModal('settingsModal'); 
    }
    
    function toggleAdminFx() {
        if (!isAdmin) return;
        adminRainbowInput = document.getElementById('toggleRainbowInput').checked;
        adminRainbowName = document.getElementById('toggleRainbowName').checked;
        adminRainbowBox = document.getElementById('toggleRainbowBox').checked;
        
        // Local Effect only (Input Box)
        const input = document.getElementById('wizsInput');
        if (adminRainbowInput) input.classList.add('rainbow-input-local');
        else input.classList.remove('rainbow-input-local');
    }

    function unblockAll() { blockedIds.clear(); openSettings(); }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    document.getElementById('cancel-reply').onclick = () => { selectedReply = null; document.getElementById('reply-preview').style.display = 'none'; };
</script>
</body>
</html>
